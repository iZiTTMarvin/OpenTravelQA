# 旅游景点智能问答系统

## 项目报告

**课程名称：** 自然语言处理

**项目名称：** 旅游景点智能问答系统

**完成时间：** 2025年

---

## 团队成员

| 角色 | 姓名 |
|------|------|
| 组长 | 王思琪 |
| 组员 | 禹红倩 |
| 组员 | 马成龙 |
| 组员 | 张楠 |
| 组员 | 罗应萍 |

---

## 目录

1. [项目概述](#1-项目概述)
2. [系统架构设计](#2-系统架构设计)
3. [核心技术实现](#3-核心技术实现)
4. [数据集与知识库](#4-数据集与知识库)
5. [系统功能模块](#5-系统功能模块)
6. [实验结果与分析](#6-实验结果与分析)
7. [系统演示](#7-系统演示)
8. [总结与展望](#8-总结与展望)
9. [参考资料](#9-参考资料)

---

## 1. 项目概述

### 1.1 项目背景

随着旅游业的快速发展，游客对旅游信息的需求日益增长。传统的旅游信息查询方式效率低下，无法满足用户个性化、即时性的信息需求。智能问答系统作为自然语言处理技术的重要应用，能够为用户提供便捷、高效的信息查询服务。

本项目旨在构建一个旅游景点智能问答系统，利用自然语言处理技术，实现对用户自然语言问题的理解和回答，为用户提供景点门票、开放时间、地址、简介等多维度的旅游信息服务。

### 1.2 项目目标

1. **构建旅游景点知识库**：整合多个城市的旅游景点数据，形成结构化知识库
2. **实现多种问答方法**：对比分析基于规则、文本分类和RAG三种问答技术
3. **开发可视化交互界面**：提供友好的Web交互界面，便于用户使用和演示
4. **探索NLP技术应用**：在实际场景中应用意图识别、实体识别、文本检索等NLP技术

### 1.3 技术栈

| 类别 | 技术/工具 |
|------|-----------|
| 编程语言 | Python 3.12 |
| Web框架 | Streamlit |
| 机器学习 | scikit-learn (TF-IDF, LinearSVC) |
| 中文处理 | jieba 分词 |
| 数据处理 | pandas, numpy |
| 大模型API | 硅基流动、Ollama、OpenAI |
| 版本控制 | Git |

---

## 2. 系统架构设计

### 2.1 整体架构

本系统采用模块化设计，主要包含以下层次：

```
┌─────────────────────────────────────────────────────────────┐
│                     Web 交互层 (Streamlit)                    │
│                        main.py                               │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                     问答方法选择层                            │
├───────────────┬───────────────────┬─────────────────────────┤
│  基于规则问答  │   文本分类问答    │      LLM RAG问答        │
│ rule_based_qa │ text_classification│      llm_rag_qa        │
│     .py       │      _qa.py       │         .py            │
└───────────────┴───────────────────┴─────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                     知识库层 (Knowledge Base)                 │
│                merged_attractions.csv                        │
│              (景点数据: 名称、地址、门票、时间等)               │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 问答流程

```
用户输入问题
     │
     ▼
┌─────────────────┐
│   方法选择      │
└────────┬────────┘
         │
    ┌────┼────┬────────────┐
    │    │    │            │
    ▼    ▼    ▼            ▼
 规则方法  分类方法      RAG方法
    │    │    │            │
    ▼    ▼    ▼            ▼
关键词   TF-IDF+     向量检索+
匹配    LinearSVC    LLM生成
    │    │    │            │
    └────┴────┴────────────┘
                │
                ▼
         ┌──────────┐
         │ 生成回答  │
         └──────────┘
```

### 2.3 文件结构

```
wsq/
├── main.py                    # Streamlit主程序入口
├── data_preprocessing.py      # 数据预处理脚本
├── requirements.txt           # 项目依赖
├── CLAUDE.md                  # 项目开发文档
├── README.md                  # 项目说明
│
├── code/                      # 核心代码目录
│   ├── __init__.py
│   ├── rule_based_qa.py       # 基于规则的问答模块
│   ├── text_classification_qa.py  # 基于文本分类的问答模块
│   └── llm_rag_qa.py          # 基于LLM RAG的问答模块
│
├── data/                      # 数据目录
│   ├── merged_attractions.csv # 合并后的景点知识库
│   ├── 上海.csv               # 上海景点原始数据
│   ├── 银川.csv               # 银川景点原始数据
│   ├── 海口.csv               # 海口景点原始数据
│   ├── 固原.csv               # 固原景点原始数据
│   ├── 呼和浩特.csv           # 呼和浩特景点原始数据
│   └── 景德镇.csv             # 景德镇景点原始数据
│
├── models/                    # 模型目录
│   └── intent_classifier.pkl  # 训练好的意图分类模型
│
└── docs/                      # 文档目录
```

---

## 3. 核心技术实现

### 3.1 基于规则的问答 (Rule-based QA)

#### 3.1.1 技术原理

基于规则的问答方法采用**关键词匹配**进行意图识别，**词典匹配**进行实体识别，最后通过**模板填充**生成回答。

#### 3.1.2 意图识别

系统定义了12种用户意图，每种意图对应一组关键词：

| 意图标签 | 中文描述 | 关键词示例 |
|---------|---------|-----------|
| ASK_TICKET | 询问门票价格 | 门票、票价、多少钱、收费 |
| ASK_OPEN_TIME | 询问开放时间 | 开放时间、几点开门、营业时间 |
| ASK_INTRO | 询问景点简介 | 介绍、简介、是什么、特色 |
| ASK_ADDRESS | 询问地址位置 | 地址、在哪、位置、怎么去 |
| ASK_PHONE | 询问联系电话 | 电话、联系方式、客服热线 |
| ASK_WEBSITE | 询问官方网站 | 官网、网站、网址 |
| ASK_RATING | 询问评分评价 | 评分、评价、好不好 |
| ASK_SUGGEST_TIME | 询问游玩时间 | 玩多久、游玩时间、待多久 |
| ASK_TAGS | 询问景点标签 | 标签、类型、什么类型 |
| ASK_TIPS | 询问游玩贴士 | 贴士、注意事项、攻略 |
| ASK_LOCATION | 询问所在位置 | 哪个城市、什么省 |
| ASK_RECOMMEND | 景点推荐 | 推荐、好玩的、值得去 |

#### 3.1.3 实体识别

从知识库动态构建实体词典，支持三类实体：
- **景点名称**：如"上海迪士尼"、"外滩"、"东方明珠"
- **城市名称**：如"上海"、"银川"、"海口"
- **省份名称**：如"上海"、"宁夏"、"海南"

#### 3.1.4 回答生成

根据识别到的意图，使用预定义模板生成回答：

```python
回答模板库 = {
    "ASK_TICKET": "【{name}】的门票价格为：{ticket_price}",
    "ASK_OPEN_TIME": "【{name}】的开放时间为：{open_time}",
    "ASK_INTRO": "【{name}】景点简介：\n{description}",
    # ... 更多模板
}
```

#### 3.1.5 核心代码

```python
def rule_based_qa(question: str, kb: pd.DataFrame) -> Dict:
    """基于规则的问答主函数"""
    # 1. 构建实体词典
    实体词典 = 构建实体词典(kb)
    
    # 2. 识别意图
    意图, 置信度 = 识别意图(question)
    
    # 3. 识别实体
    实体 = 识别实体(question, 实体词典)
    
    # 4. 查询知识库并生成回答
    if 实体["景点"]:
        景点数据 = 查询景点(实体["景点"][0], kb)
        槽位值 = 填充槽位(意图, 景点数据)
        回答 = 生成回答(意图, 槽位值)
    
    return 结果
```

---

### 3.2 基于文本分类的问答 (Text Classification QA)

#### 3.2.1 技术原理

采用**TF-IDF特征提取**结合**LinearSVC分类器**进行意图分类，然后结合知识库生成回答。

#### 3.2.2 训练数据集

为每个意图类别构建了至少15条训练样本：

```python
训练数据集 = {
    "ASK_TICKET": [
        "这个景点门票多少钱",
        "请问门票价格是多少",
        "入场需要花多少钱",
        # ... 更多样本
    ],
    "ASK_OPEN_TIME": [
        "景点几点开门",
        "开放时间是什么时候",
        # ... 更多样本
    ],
    # ... 共12类意图
}
```

#### 3.2.3 模型架构

```
用户问题
    │
    ▼
┌─────────────┐
│  jieba分词   │  ──── 中文分词处理
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  TF-IDF     │  ──── 文本向量化
│  Vectorizer │       max_features=5000
└──────┬──────┘       ngram_range=(1,2)
       │
       ▼
┌─────────────┐
│  LinearSVC  │  ──── 支持向量机分类
│  Classifier │       class_weight='balanced'
└──────┬──────┘
       │
       ▼
  意图预测结果
```

#### 3.2.4 核心代码

```python
class 意图分类器:
    def __init__(self):
        self.模型管道 = Pipeline([
            ('tfidf', TfidfVectorizer(
                max_features=5000,
                ngram_range=(1, 2),
                sublinear_tf=True
            )),
            ('svc', LinearSVC(
                C=1.0,
                class_weight='balanced',
                max_iter=10000
            ))
        ])
    
    def 预测(self, 问题: str) -> Tuple[str, float]:
        分词后问题 = 中文分词(问题)
        预测结果 = self.模型管道.predict([分词后问题])[0]
        决策分数 = self.模型管道.decision_function([分词后问题])[0]
        置信度 = float(np.max(np.exp(决策分数) / np.sum(np.exp(决策分数))))
        return 预测结果, 置信度
```

#### 3.2.5 模型持久化

训练好的模型保存到 `models/intent_classifier.pkl`，后续运行直接加载无需重新训练。

---

### 3.3 基于LLM RAG的问答 (LLM RAG QA)

#### 3.3.1 技术原理

**RAG (Retrieval-Augmented Generation)** 检索增强生成技术，结合向量检索和大语言模型生成能力：

1. 将知识库文档向量化
2. 根据用户问题检索相关文档
3. 将检索结果和问题组合成Prompt
4. 调用大模型生成自然语言回答

#### 3.3.2 文档构建

将CSV数据转换为标准文档格式：

```
【景点名称】上海迪士尼度假区
【所在城市】上海
【所在省份】上海
【详细地址】上海市浦东新区川沙镇黄赵路310号
【联系电话】400-180-0000
【门票价格】¥399起
【开放时间】8:30-20:30
【景点简介】上海迪士尼度假区是中国内地首座迪士尼主题乐园...
```

#### 3.3.3 混合检索策略

采用 **TF-IDF相似度 + 实体感知加权** 的混合检索策略：

```python
def 检索(self, 查询文本: str, 知识库: pd.DataFrame) -> List[Dict]:
    # 1. 计算TF-IDF余弦相似度作为基础分数
    基础相似度 = cosine_similarity(查询向量, 文档向量)
    
    # 2. 实体感知加权
    for 文档 in 文档列表:
        加权值 = 0
        if 文档城市 in 识别到的城市:
            加权值 += 0.5  # 城市匹配
        if 文档名称 in 识别到的景点:
            加权值 += 0.8  # 景点名精确匹配
        实体加权分数[i] = 加权值
    
    # 3. 综合分数计算
    if 有实体匹配:
        综合分数 = 0.3 * TF-IDF分数 + 0.7 * 实体加权分数
    else:
        综合分数 = TF-IDF分数
    
    return Top-K文档
```

#### 3.3.4 Prompt设计

**系统提示词：**
```
你是一个专业的旅游景点智能问答助手。你的任务是根据提供的景点信息文档，准确、友好地回答用户的问题。

重要规则：
1. 只能根据提供的文档内容回答问题，不要编造或推测任何信息
2. 如果文档中没有相关信息，请诚实地告诉用户
3. 回答要简洁明了，突出关键信息
4. 使用友好、专业的语气
```

**用户Prompt模板：**
```
请根据以下景点信息文档，回答用户的问题。

【参考文档】
{检索到的文档内容}

【用户问题】
{用户的问题}

请基于以上文档信息回答用户的问题：
```

#### 3.3.5 多LLM支持

系统支持多种大模型API：

| 模型类型 | 说明 | API地址 |
|---------|------|---------|
| siliconflow | 硅基流动（推荐） | api.siliconflow.cn |
| ollama | 本地部署 | localhost:11434 |
| openai | OpenAI官方 | api.openai.com |
| qianwen | 通义千问 | dashscope.aliyuncs.com |

#### 3.3.6 备用回答机制

当LLM不可用时，系统自动回退到模板生成方式，确保始终能返回有效回答。

---

## 4. 数据集与知识库

### 4.1 数据来源

景点数据来自6个城市的旅游景点信息：

| 城市 | 省份 | 数据量 |
|------|------|--------|
| 上海 | 上海 | 约150条 |
| 银川 | 宁夏 | 约60条 |
| 海口 | 海南 | 约50条 |
| 固原 | 宁夏 | 约40条 |
| 呼和浩特 | 内蒙古 | 约50条 |
| 景德镇 | 江西 | 约30条 |

### 4.2 数据字段

| 字段名 | 类型 | 说明 |
|--------|------|------|
| dataid | int | 数据唯一标识 |
| name | string | 景点名称 |
| city | string | 所在城市 |
| province | string | 所在省份 |
| address | string | 详细地址 |
| phone | string | 联系电话 |
| website | string | 官方网站 |
| rating | float | 用户评分(0-5) |
| ticket_price | string | 门票价格 |
| open_time | string | 开放时间 |
| suggest_time | string | 建议游玩时间 |
| tags | string | 景点标签 |
| description | string | 景点简介 |
| tips | string | 游玩贴士 |

### 4.3 数据预处理

`data_preprocessing.py` 实现了完整的数据清洗流程：

1. **编码处理**：支持UTF-8、GBK、GB2312等多种编码
2. **文本清洗**：去除多余空白、换行符
3. **字段提取**：从复合字段中提取地址、电话、网站
4. **名称清理**：去除景点名称中的英文名
5. **标签生成**：根据景点特征自动生成分类标签
6. **数据去重**：按景点名称和城市去重
7. **数据合并**：将多个城市数据合并为统一格式

---

## 5. 系统功能模块

### 5.1 Web界面 (main.py)

基于Streamlit构建的交互式Web界面：

#### 5.1.1 界面布局

- **侧边栏**：方法选择、RAG配置、数据统计
- **主内容区**：问题输入、示例问题、结果展示
- **结果展示**：4个标签页（最终回答、意图识别、实体识别、详细信息）

#### 5.1.2 主要功能

1. **问答方法切换**：支持三种问答方法的切换对比
2. **RAG配置**：可配置LLM模型类型、API密钥、检索数量
3. **示例问题**：提供常用问题示例，点击即可查询
4. **结果可视化**：展示意图识别、实体识别、检索文档等详细信息

#### 5.1.3 UI设计

采用现代简洁风格，紫色主题配色：
- 主色调：#667eea, #764ba2, #8b5cf6
- 卡片式布局，圆角设计
- 响应式适配，支持宽屏展示

### 5.2 问答结果格式

三种方法返回统一的数据格式：

```python
{
    "intent": "ASK_TICKET",           # 意图标签
    "intent_confidence": 0.85,        # 意图置信度
    "entities": {                     # 识别的实体
        "景点": ["上海迪士尼"],
        "城市": ["上海"],
        "省份": []
    },
    "answer": "【上海迪士尼】的门票价格为：¥399起",  # 回答
    "matched_attraction": "上海迪士尼度假区",        # 匹配景点
    "slots": {...},                   # 槽位值（规则/分类方法）
    "retrieved_docs": [...],          # 检索文档（RAG方法）
    "prompt": "...",                  # LLM Prompt（RAG方法）
    "use_llm": True                   # 是否使用LLM
}
```

---

## 6. 实验结果与分析

### 6.1 三种方法对比

| 评估维度 | 基于规则 | 文本分类 | LLM RAG |
|---------|---------|---------|---------|
| 响应时间 | <100ms | 100-500ms | 1-10s |
| 意图识别准确率 | 中（依赖关键词覆盖） | 高（机器学习泛化） | 高（LLM理解能力） |
| 回答自然度 | 低（模板化） | 低（模板化） | 高（自然生成） |
| 可扩展性 | 低（需手动添加规则） | 中（需添加训练数据） | 高（知识库扩展即可） |
| 资源消耗 | 低 | 中 | 高（需要LLM） |
| 适用场景 | 固定模式问题 | 常见意图识别 | 复杂问题、自然交互 |

### 6.2 文本分类模型评估

训练集/测试集划分：80%/20%（Stratified Split）

| 意图类别 | Precision | Recall | F1-Score |
|---------|-----------|--------|----------|
| ASK_TICKET | 1.00 | 1.00 | 1.00 |
| ASK_OPEN_TIME | 0.95 | 1.00 | 0.97 |
| ASK_INTRO | 0.92 | 0.92 | 0.92 |
| ASK_ADDRESS | 1.00 | 0.95 | 0.97 |
| ASK_PHONE | 1.00 | 1.00 | 1.00 |
| ASK_WEBSITE | 1.00 | 1.00 | 1.00 |
| ASK_RATING | 0.95 | 0.95 | 0.95 |
| ASK_SUGGEST_TIME | 1.00 | 1.00 | 1.00 |
| ASK_TAGS | 0.92 | 0.92 | 0.92 |
| ASK_TIPS | 1.00 | 1.00 | 1.00 |
| ASK_LOCATION | 1.00 | 1.00 | 1.00 |
| ASK_RECOMMEND | 0.95 | 0.95 | 0.95 |

**总体准确率：** 约 97%

### 6.3 RAG检索效果

混合检索策略（TF-IDF + 实体加权）相比纯TF-IDF的改进：

| 测试问题类型 | 纯TF-IDF准确率 | 混合策略准确率 |
|-------------|---------------|---------------|
| 包含景点名 | 95% | 98% |
| 包含城市名 | 60% | 92% |
| 模糊问题 | 70% | 85% |

实体加权有效解决了"XX城市有什么好玩的"类问题的检索准确性。

### 6.4 测试用例

| 测试问题 | 方法 | 回答示例 |
|---------|------|---------|
| "上海迪士尼门票多少钱？" | 规则 | 【上海迪士尼度假区】的门票价格为：¥399起 |
| "外滩几点开门？" | 分类 | 【外滩】的开放时间为：全天开放 |
| "给我介绍一下东方明珠" | RAG | 东方明珠广播电视塔是上海的标志性建筑，位于浦东新区世纪大道1号... |
| "银川有什么好玩的？" | RAG | 为您推荐银川的热门景点：1.【镇北堡西部影城】2.【水洞沟】3.【西夏王陵】... |

---

## 7. 系统演示

### 7.1 运行方式

```bash
# 安装依赖
pip install -r requirements.txt

# 启动系统
streamlit run main.py

# 默认访问地址：http://localhost:8501
```

### 7.2 界面截图说明

**主界面**：
- 顶部：系统标题和简介
- 中部：问题输入框和提问按钮
- 下部：示例问题和结果展示区

**结果展示**：
- Tab1：最终回答（卡片式展示）
- Tab2：意图识别（意图标签、置信度进度条）
- Tab3：实体识别（景点、城市、省份实体）
- Tab4：详细信息（RAG检索文档、LLM Prompt）

### 7.3 使用流程

1. 在侧边栏选择问答方法（规则/分类/RAG）
2. 如选择RAG方法，配置大模型类型和API密钥
3. 在输入框输入问题或点击示例问题
4. 点击"提问"按钮获取回答
5. 查看不同标签页了解详细处理过程

---

## 8. 总结与展望

### 8.1 项目成果

1. **成功构建了旅游景点问答系统**，整合6个城市约380条景点数据
2. **实现了三种问答方法**，可对比分析不同技术的特点
3. **开发了友好的Web界面**，便于用户交互和演示
4. **探索了多种NLP技术的实际应用**，包括意图识别、实体识别、文本分类、向量检索、Prompt工程等

### 8.2 技术收获

- 深入理解了问答系统的技术架构
- 掌握了TF-IDF、SVM等机器学习方法在NLP中的应用
- 了解了RAG技术的原理和实现方式
- 学习了大模型API的调用和Prompt设计技巧

### 8.3 存在不足

1. **知识库规模有限**：仅覆盖6个城市，数据量较小
2. **向量检索精度**：使用TF-IDF而非深度学习Embedding
3. **多轮对话支持**：当前仅支持单轮问答
4. **意图覆盖不全**：仅支持12种预定义意图

### 8.4 未来展望

1. **扩展知识库**：接入更多城市和景点数据
2. **引入深度学习**：使用BERT、BGE等模型提升语义理解
3. **支持多轮对话**：实现上下文理解和追问功能
4. **知识图谱构建**：建立景点间的关联关系
5. **个性化推荐**：根据用户偏好进行智能推荐

---

## 9. 参考资料

1. Streamlit官方文档: https://docs.streamlit.io/
2. scikit-learn用户指南: https://scikit-learn.org/stable/user_guide.html
3. jieba中文分词: https://github.com/fxsjy/jieba
4. 硅基流动API文档: https://docs.siliconflow.cn/
5. RAG技术综述: Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks

---

## 附录

### A. 依赖清单 (requirements.txt)

```
streamlit>=1.28.0
pandas>=1.5.0
numpy>=1.23.0
scikit-learn>=1.2.0
jieba>=0.42.1
requests>=2.28.0
ollama>=0.1.0
```

### B. 运行命令汇总

```bash
# 启动Web应用
streamlit run main.py

# 测试规则问答模块
python code/rule_based_qa.py

# 测试分类问答模块（自动训练）
python code/text_classification_qa.py

# 测试RAG问答模块
python code/llm_rag_qa.py

# 重新预处理数据
python data_preprocessing.py
```

---

**项目仓库：** [项目目录] D:\visual_ProgrammingSoftware\Qoder_projects\wsq

**报告完成时间：** 2025年

**团队：** 王思琪团队
